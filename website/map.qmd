---
title: "Carte Interactive"
format:
  html:
    theme: cosmo
    toc: false
jupyter: python3
---

Visualisation g√©olocalis√©e des indicateurs cl√©s (Donn√©es les plus r√©centes).

```{python}
#| echo: false
#| warning: false

import folium
from health4earth.data_ingest import load_merged_data

df = load_merged_data()
# On prend 2019 car c'est l'ann√©e la plus compl√®te pour la pollution
df_recent = df[df['year'] == 2019]

# Liste des pays √† afficher
capitals = {
    'France': [48.85, 2.35],
    'United States': [38.90, -77.03],
    'China': [39.90, 116.40],
    'India': [28.61, 77.20],
    'Brazil': [-15.78, -47.92],
    'Germany': [52.52, 13.40]
}

m = folium.Map(location=[25, 0], zoom_start=2, tiles="CartoDB positron")

for country, coords in capitals.items():
    row = df_recent[df_recent['country'] == country]
    
    if not row.empty:
        co2 = row['co2'].values[0]
        life = row['life_expectancy'].values[0]
        deaths = int(row['pollution_deaths'].values[0])
        
        # Code HTML pour le popup interactif
        html = f"""
        <div style="font-family:sans-serif; width:180px">
            <h4>{country}</h4>
            <hr>
            <b>CO2:</b> {co2:.0f} Mt<br>
            <b>Vie:</b> {life:.1f} ans<br>
            <b>D√©c√®s (Air):</b> {deaths:,}<br>
            <br>
            <a href="index.html" target="_top" style="color:blue">Voir Analyse üìà</a>
        </div>
        """
        
        # Couleur selon le CO2
        color = 'red' if co2 > 1000 else 'orange' if co2 > 300 else 'green'
        
        folium.Marker(
            location=coords,
            popup=folium.Popup(html, max_width=250),
            icon=folium.Icon(color=color, icon="info-sign")
        ).add_to(m)

m