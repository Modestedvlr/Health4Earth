---
title: "Carte interactive ‚Äî HEALTH4EARTH"
format: html
---

# üåç Carte interactive ‚Äî S√©lecteur d‚Äôindicateur

<div>
  <label for="indicator">Choisir un indicateur :</label>
  <select id="indicator">
    <option value="co2">√âmissions de CO‚ÇÇ</option>
    <option value="pollution">Mortalit√© pollution</option>
    <option value="life">Esp√©rance de vie</option>
  </select>
</div>

<div id="map" style="height: 600px; margin-top: 10px;"></div>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
// Initialiser la carte
const map = L.map('map').setView([20, 0], 2);

// Fond de carte
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '¬© OpenStreetMap contributors'
}).addTo(map);

// Fonction couleur
function getColor(d) {
  return d > 80 ? '#800026' :
         d > 50 ? '#BD0026' :
         d > 20 ? '#E31A1C' :
         d > 10 ? '#FC4E2A' :
         d > 5  ? '#FD8D3C' :
         d > 1  ? '#FEB24C' :
                  '#FFEDA0';
}

// Charger les donn√©es
Promise.all([
  fetch("data/series_co2.json").then(r => r.json()),
  fetch("data/series_pollution.json").then(r => r.json()),
  fetch("data/series_life.json").then(r => r.json()),
  fetch("data/world.geojson").then(r => r.json())
]).then(([co2Data, pollutionData, lifeData, world]) => {

  const datasets = { co2: co2Data, pollution: pollutionData, life: lifeData };
  let currentIndicator = "co2";

  // Style dynamique
  function style(feature) {
    const iso = feature.properties.ISO_A3;
    const value = datasets[currentIndicator][iso]?.[currentIndicator] ?? 0;
    return {
      fillColor: getColor(value),
      weight: 1,
      opacity: 1,
      color: 'white',
      fillOpacity: 0.7
    };
  }

  // Couche choropl√®the
  const geojsonLayer = L.geoJson(world, {
    style: style,
    onEachFeature: function (feature, layer) {
      const iso = feature.properties.ISO_A3;
      const val = datasets[currentIndicator][iso]?.[currentIndicator] ?? "N/A";
      layer.bindPopup(`<b>${feature.properties.ADMIN}</b><br/>${currentIndicator.toUpperCase()}: ${val}`);
    }
  }).addTo(map);

  // Mise √† jour de l‚Äôindicateur
  document.getElementById("indicator").addEventListener("change", function(e) {
    currentIndicator = e.target.value;
    geojsonLayer.eachLayer(function(layer) {
      layer.setStyle(style(layer.feature));
      const iso = layer.feature.properties.ISO_A3;
      const val = datasets[currentIndicator][iso]?.[currentIndicator] ?? "N/A";
      layer.bindPopup(`<b>${layer.feature.properties.ADMIN}</b><br/>${currentIndicator.toUpperCase()}: ${val}`);
    });
  });
});
</script>
