name: CI Health4Earth

# Déclenchement
on:
  push:
    branches: ["main", "master", "dev"]
  pull_request:
    branches: ["main", "master"]

jobs:
  test-project:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: ["3.10"]

    steps:
    # 1. Récupérer le code
    - uses: actions/checkout@v3

    # 2. Installer Python
    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v4
      with:
        python-version: ${{ matrix.python-version }}

    # 3. Installer les dépendances
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        # Installe le projet en mode éditable ainsi que les dépendances listées dans pyproject.toml
        # L'option [dev] installe aussi pytest et flake8 définis dans le toml
        pip install -e .[dev]

    # 4. Vérifier la structure (Debug)
    # Cette étape nous aidera à voir si l'installation a marché
    - name: Check installation
      run: |
        pip list
        python -c "import health4earth; print('Module health4earth trouvé !')"

    # 5. Lancer les tests
    - name: Run Tests
      run: |
        pytest tests/